<!DOCTYPE html>
<html>
<head>
  <title>XonoHub Key Generator</title>
  <meta charset="UTF-8">
  <style>
    body { background:#111; color:white; font-family:sans-serif; text-align:center; }
    h2 { margin-top:50px; }
    #key { font-size:24px; font-weight:bold; margin:20px 0; }
    p { margin:10px 0; }
    button { padding:10px 20px; font-size:16px; cursor:pointer; margin-top:20px; }
  </style>
</head>
<body>

<h2>Your XonoHub Key</h2>
<p id="key">Loading...</p>
<p>Copy this key and paste it into your hub</p>
<button id="refresh">Get New Key</button>

<script>
const DAY = 86400; // 24 hours in seconds
const keyLabel = document.getElementById("key");
const refreshBtn = document.getElementById("refresh");

// fetch keys from the same origin (keys.json must be in the root folder)
async function fetchKey() {
  try {
    const res = await fetch("keys.json");
    const data = await res.json();
    const now = Math.floor(Date.now()/1000);

    // filter valid keys: not expired, not HWID-locked
    const validKeys = Object.keys(data).filter(k => {
      const entry = data[k];
      return (!entry.hwid) && ((now - entry.created) <= DAY);
    });

    if (validKeys.length === 0) {
      keyLabel.innerText = "No valid keys available, try later";
      return;
    }

    // pick a random key
    const randomKey = validKeys[Math.floor(Math.random() * validKeys.length)];
    keyLabel.innerText = randomKey;

  } catch (err) {
    console.error(err);
    keyLabel.innerText = "Failed to fetch keys";
  }
}

// initial fetch
fetchKey();

// allow user to get a new key on button click
refreshBtn.addEventListener("click", fetchKey);
</script>

</body>
</html>
